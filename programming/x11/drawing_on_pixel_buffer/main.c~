#include <stdio.h>
#include <stdlib.h>

#include <X11/Xlib.h>

#define WIDTH  600
#define HEIGHT 800

int pixels[WIDTH*HEIGHT];

int main(){
  Display *display = XOpenDisplay(NULL);
  if(display == NULL){
    fprintf(stderr,"ERROR: Could not open the display\n");
    exit(1);
  }
  Window window = XCreateSimpleWindow(display,XDefaultRootWindow(display),
				      0,0,
				      HEIGHT,WIDTH,
				      0,0,
				      0x00ff0000);
  GC gc = XCreateGC(display, window, 0, NULL);

  // Doing some weird WM magic
  Atom window_delete = XInternAtom(display,"WM_DELETE_WINDOW",1);
  XSetWMProtocols(display,window,&window_delete,1);
  
  printf("The atom is %d\n",(int)window_delete);
  
  XMapWindow(display,window);

  // Getting the windows attributes
  XWindowAttributes wa = {0};
  XGetWindowAttributes(display,window,&wa);
  
  // Creating the image from the buffer
  XImage image = XCreateImage(display,
		       wa.visual,
		       wa.depth,
		       ZPixmap, 0, pixles,
		       WIDTH,HEIGHT,
		       32, WIDTH * 4);
  if(image == NULL){
    fp
  }
  

  XEvent event;
  int quit = 0;
  while(!quit){
    XNextEvent(display,&event);
    switch(event.type){
    case ClientMessage:
      {
	if((Atom)event.xclient.data.l[0] == window_delete){
	  quit = 1;
	}
      }
      break;
    default:
      printf("Unknown event!!\n");
    }
  }
  
  return 0;
}
